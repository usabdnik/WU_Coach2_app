# Moyklass CRM ‚Üí Supabase Import

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—á–µ–Ω–∏–∫–æ–≤ –∏–∑ api.moyklass.com –≤ Supabase.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd migration
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
SUPABASE_URL=https://mjkssesvhowmncyctmvs.supabase.co
SUPABASE_SERVICE_KEY=your_service_role_key_here
MOYKLASS_API_KEY=cUxxeiyq5CqerJpsBN9nptWxMncuTx8JFeCnudCRTA4q9G56Ia
```

**–ì–¥–µ –Ω–∞–π—Ç–∏:**
- `SUPABASE_SERVICE_KEY`: Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí service_role
- `MOYKLASS_API_KEY`: –£–∂–µ —É–∫–∞–∑–∞–Ω –≤ .env.example (—Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –∏–∑ Apps Script)

### 3. –ó–∞–ø—É—Å–∫

```bash
npm run import
```

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (GitHub Actions)

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://github.com/usabdnik/WU_Coach2_app/settings/secrets/actions
2. –î–æ–±–∞–≤—å—Ç–µ **3 —Å–µ–∫—Ä–µ—Ç–∞**:

| –°–µ–∫—Ä–µ—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|
| `SUPABASE_URL` | `https://mjkssesvhowmncyctmvs.supabase.co` |
| `SUPABASE_SERVICE_KEY` | –ò–∑ Supabase Dashboard ‚Üí API |
| `MOYKLASS_API_KEY` | `cUxxeiyq5CqerJpsBN9nptWxMncuTx8JFeCnudCRTA4q9G56Ia` |

### –ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:** –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç

**–í—Ä—É—á–Ω—É—é:** https://github.com/usabdnik/WU_Coach2_app/actions/workflows/crm-sync.yml
- –ù–∞–∂–º–∏—Ç–µ "Run workflow"
- –í—ã–±–µ—Ä–∏—Ç–µ "main"
- –ù–∞–∂–º–∏—Ç–µ "Run workflow"

---

## üìä –ß—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è

–°–∫—Ä–∏–ø—Ç:
1. –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –æ—Ç api.moyklass.com
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã
3. –§–∏–ª—å—Ç—Ä—É–µ—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã –ø–æ —Ç–µ–∫—É—â–µ–º—É —Å–µ–∑–æ–Ω—É (—Å–µ–Ω—Ç—è–±—Ä—å - –∞–≤–≥—É—Å—Ç)
4. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —É—á–µ–Ω–∏–∫–æ–≤
5. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å:
   - **–ê–∫—Ç–∏–≤–µ–Ω**: –ï—Å—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç –≤ —Ç–µ–∫—É—â–µ–º —Å–µ–∑–æ–Ω–µ
   - **–ù–µ–∞–∫—Ç–∏–≤–µ–Ω**: –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞
6. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–µ—Ä–µ–∑ `save_athlete_with_validation()` –≤ Supabase

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç—ã

–û—Ç–∫—Ä–æ–π—Ç–µ `.github/workflows/crm-sync.yml`, —Å—Ç—Ä–æ–∫–∞ 6:

```yaml
# –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (—Ç–µ–∫—É—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- cron: '*/15 * * * *'

# –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- cron: '*/5 * * * *'

# –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- cron: '*/30 * * * *'

# –ö–∞–∂–¥—ã–π —á–∞—Å
- cron: '0 * * * *'
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ API –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ GitHub Secrets
- ‚úÖ Service Role Key –∑–∞—â–∏—â–µ–Ω
- ‚úÖ –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ GitHub Actions

---

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "Failed to get token"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á Moyklass

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `MOYKLASS_API_KEY` –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö GitHub

### –û—à–∏–±–∫–∞: "Failed to fetch subscriptions"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ API Moyklass

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å api.moyklass.com
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫

### –û—à–∏–±–∫–∞: "save_athlete_with_validation failed"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å Supabase —Ñ—É–Ω–∫—Ü–∏–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Postgres —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**Workflow:** https://github.com/usabdnik/WU_Coach2_app/actions/workflows/crm-sync.yml

**–í–µ—Ä—Å–∏—è:** 2.0.0 (Moyklass API)
**–î–∞—Ç–∞:** 2025-11-11
